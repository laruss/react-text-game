"use strict";(self.webpackChunk_react_text_game_docs=self.webpackChunk_react_text_game_docs||[]).push([[5806],{913:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>h,frontMatter:()=>i,metadata:()=>a,toc:()=>c});const a=JSON.parse('{"id":"side-effects","title":"Handling Side Effects","description":"Best practices for implementing side effects in React Text Game passages. Learn how to avoid duplicate logic when saving and loading, and structure your game code for reliable state management.","source":"@site/docs/side-effects.md","sourceDirName":".","slug":"/side-effects","permalink":"/side-effects","draft":false,"unlisted":false,"editUrl":"https://github.com/laruss/tree/main/apps/docs/docs/side-effects.md","tags":[],"version":"current","sidebarPosition":4,"frontMatter":{"sidebar_position":4,"title":"Handling Side Effects","description":"Best practices for implementing side effects in React Text Game passages. Learn how to avoid duplicate logic when saving and loading, and structure your game code for reliable state management.","keywords":["side effects","game state","save load","best practices","passage actions","state management","react text game"],"image":"/img/og-image.webp"},"sidebar":"docsSidebar","previous":{"title":"Core Concepts","permalink":"/core-concepts"},"next":{"title":"MDX Integration","permalink":"/mdx-integration"}}');var s=t(1085),r=t(1184);const i={sidebar_position:4,title:"Handling Side Effects",description:"Best practices for implementing side effects in React Text Game passages. Learn how to avoid duplicate logic when saving and loading, and structure your game code for reliable state management.",keywords:["side effects","game state","save load","best practices","passage actions","state management","react text game"],image:"/img/og-image.webp"},o="Handling Side Effects",l={},c=[{value:"Understanding the Problem",id:"understanding-the-problem",level:2},{value:"How Passages Work",id:"how-passages-work",level:3},{value:"The Save/Load Problem",id:"the-saveload-problem",level:3},{value:"The Solution: Actions, Not Passage Bodies",id:"the-solution-actions-not-passage-bodies",level:2},{value:"Correct Pattern",id:"correct-pattern",level:3},{value:"Common Scenarios and Solutions",id:"common-scenarios-and-solutions",level:2},{value:"Scenario 1: One-Time Events",id:"scenario-1-one-time-events",level:3},{value:"Scenario 2: Combat or Resource Changes",id:"scenario-2-combat-or-resource-changes",level:3},{value:"Scenario 3: Random Events",id:"scenario-3-random-events",level:3},{value:"Scenario 4: Tracking Visit Counts",id:"scenario-4-tracking-visit-counts",level:3},{value:"Interactive Maps",id:"interactive-maps",level:2},{value:"Summary: The Golden Rule",id:"summary-the-golden-rule",level:2},{value:"Related Topics",id:"related-topics",level:2}];function d(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"handling-side-effects",children:"Handling Side Effects"})}),"\n",(0,s.jsx)(n.p,{children:"When building interactive narratives with React Text Game, it's important to understand how passages are rendered and how to properly handle side effects like modifying game state, awarding items, or tracking statistics."}),"\n",(0,s.jsx)(n.h2,{id:"understanding-the-problem",children:"Understanding the Problem"}),"\n",(0,s.jsxs)(n.p,{children:["A ",(0,s.jsx)(n.strong,{children:"side effect"})," is any operation that modifies state outside the passage's display content - for example, giving the player an item, reducing health, or incrementing a counter."]}),"\n",(0,s.jsx)(n.h3,{id:"how-passages-work",children:"How Passages Work"}),"\n",(0,s.jsxs)(n.p,{children:["When a passage is displayed, the engine calls its ",(0,s.jsx)(n.code,{children:"display()"})," function to generate the content. This happens:"]}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"When the player navigates to the passage"})," - The first render"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"When the player saves and loads the game"})," - React re-mounts the component"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"When React re-renders"})," - Due to state changes or parent re-renders"]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["If you put side effects directly in the passage body, they will execute ",(0,s.jsx)(n.strong,{children:"every time"})," ",(0,s.jsx)(n.code,{children:"display()"})," is called:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-tsx",children:'// BAD: Side effect in passage body\nconst treasureRoom = newStory("treasure-room", () => {\n    // This runs EVERY TIME the passage is displayed!\n    player.gold += 100; // Player gets 100 gold on first visit\n    player.gold += 100; // ...and again when loading a save\n    player.gold += 100; // ...and again on any re-render\n\n    return [\n        { type: "text", content: "You found a treasure chest!" },\n        { type: "text", content: `You now have ${player.gold} gold.` },\n    ];\n});\n'})}),"\n",(0,s.jsx)(n.h3,{id:"the-saveload-problem",children:"The Save/Load Problem"}),"\n",(0,s.jsx)(n.p,{children:"Consider this scenario:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"Player enters the treasure room for the first time"}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"display()"})," runs, player gets +100 gold (now has 100)"]}),"\n",(0,s.jsx)(n.li,{children:"Player saves the game"}),"\n",(0,s.jsx)(n.li,{children:"Player loads the save"}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"display()"})," runs again, player gets +100 gold (now has 200!)"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"This is a critical bug - the player's gold keeps increasing every time they load their save."}),"\n",(0,s.jsx)(n.h2,{id:"the-solution-actions-not-passage-bodies",children:"The Solution: Actions, Not Passage Bodies"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Always implement side effects in actions"}),", not in the passage body. Actions are user-triggered and only execute when the player explicitly clicks a button."]}),"\n",(0,s.jsx)(n.h3,{id:"correct-pattern",children:"Correct Pattern"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-tsx",children:'// GOOD: Side effect in action\nconst treasureRoom = newStory("treasure-room", () => [\n    { type: "text", content: "You found a treasure chest!" },\n    {\n        type: "actions",\n        content: [\n            {\n                label: "Open the chest",\n                action: () => {\n                    // This only runs when the player clicks the button\n                    player.gold += 100;\n                    Game.jumpTo("treasure-collected");\n                },\n            },\n            {\n                label: "Leave it alone",\n                action: () => Game.jumpTo("corridor"),\n            },\n        ],\n    },\n]);\n\nconst treasureCollected = newStory("treasure-collected", () => [\n    {\n        type: "text",\n        content: `You collected 100 gold! You now have ${player.gold} gold.`,\n    },\n    {\n        type: "actions",\n        content: [{ label: "Continue", action: () => Game.jumpTo("corridor") }],\n    },\n]);\n'})}),"\n",(0,s.jsxs)(n.p,{children:["Now the gold is only awarded when the player ",(0,s.jsx)(n.strong,{children:"chooses"})," to open the chest, and loading a save won't duplicate the reward."]}),"\n",(0,s.jsx)(n.h2,{id:"common-scenarios-and-solutions",children:"Common Scenarios and Solutions"}),"\n",(0,s.jsx)(n.h3,{id:"scenario-1-one-time-events",children:"Scenario 1: One-Time Events"}),"\n",(0,s.jsx)(n.p,{children:"For events that should only happen once (finding a unique item, triggering a story event):"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-tsx",children:'// GOOD: Track one-time events\nconst player = createEntity("player", {\n    foundSecretRoom: false,\n    inventory: [] as string[],\n});\n\nconst secretRoom = newStory("secret-room", () => [\n    {\n        type: "text",\n        content: player.foundSecretRoom\n            ? "The secret room is empty now."\n            : "You discovered a hidden chamber with an ancient artifact!",\n    },\n    {\n        type: "actions",\n        content: player.foundSecretRoom\n            ? [{ label: "Leave", action: () => Game.jumpTo("main-hall") }]\n            : [\n                  {\n                      label: "Take the artifact",\n                      action: () => {\n                          player.inventory.push("ancient-artifact");\n                          player.foundSecretRoom = true;\n                          player.save();\n                          Game.jumpTo("secret-room"); // Refresh to show new state\n                      },\n                  },\n              ],\n    },\n]);\n'})}),"\n",(0,s.jsx)(n.h3,{id:"scenario-2-combat-or-resource-changes",children:"Scenario 2: Combat or Resource Changes"}),"\n",(0,s.jsx)(n.p,{children:"For passages involving combat or resource management:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-tsx",children:'// GOOD: Combat in actions\nconst battlePassage = newStory("battle", () => [\n    {\n        type: "text",\n        content: `A goblin appears! Your health: ${player.health}`,\n    },\n    {\n        type: "actions",\n        content: [\n            {\n                label: "Attack",\n                action: () => {\n                    const damage = Math.floor(Math.random() * 10) + 5;\n                    player.health -= damage;\n                    player.save();\n\n                    if (player.health <= 0) {\n                        Game.jumpTo("game-over");\n                    } else {\n                        Game.jumpTo("battle-result");\n                    }\n                },\n            },\n            {\n                label: "Run away",\n                action: () => Game.jumpTo("forest"),\n            },\n        ],\n    },\n]);\n'})}),"\n",(0,s.jsx)(n.h3,{id:"scenario-3-random-events",children:"Scenario 3: Random Events"}),"\n",(0,s.jsx)(n.p,{children:"For passages with random content that should stay consistent:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-tsx",children:'// GOOD: Generate random content once and store it\nconst player = createEntity("player", {\n    currentEventSeed: null as number | null,\n});\n\nconst randomEncounter = newStory("random-encounter", () => {\n    // Use stored seed or generate new one\n    const seed = player.currentEventSeed ?? Math.random();\n\n    // Determine encounter based on seed (deterministic)\n    const encounterType =\n        seed < 0.3 ? "merchant" : seed < 0.7 ? "traveler" : "bandit";\n\n    return [\n        {\n            type: "text",\n            content: `You encounter a ${encounterType} on the road.`,\n        },\n        {\n            type: "actions",\n            content: [\n                {\n                    label: "Approach",\n                    action: () => {\n                        // Clear seed when leaving so next encounter is different\n                        player.currentEventSeed = null;\n                        player.save();\n                        Game.jumpTo(`encounter-${encounterType}`);\n                    },\n                },\n                {\n                    label: "Avoid",\n                    action: () => {\n                        player.currentEventSeed = null;\n                        player.save();\n                        Game.jumpTo("continue-road");\n                    },\n                },\n            ],\n        },\n    ];\n});\n\n// Set seed before entering the passage\nfunction triggerRandomEncounter() {\n    player.currentEventSeed = Math.random();\n    player.save();\n    Game.jumpTo("random-encounter");\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"scenario-4-tracking-visit-counts",children:"Scenario 4: Tracking Visit Counts"}),"\n",(0,s.jsx)(n.p,{children:"For passages that should behave differently based on visit count:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-tsx",children:'// GOOD: Track visits in entity, increment in action\nconst gameState = createEntity("gameState", {\n    tavernVisits: 0,\n});\n\nconst tavernEntrance = newStory("tavern-entrance", () => [\n    {\n        type: "text",\n        content:\n            gameState.tavernVisits === 0\n                ? "You enter the tavern for the first time. The smell of ale fills the air."\n                : `You return to the tavern. The bartender recognizes you.`,\n    },\n    {\n        type: "actions",\n        content: [\n            {\n                label: "Enter",\n                action: () => {\n                    gameState.tavernVisits += 1;\n                    gameState.save();\n                    Game.jumpTo("tavern-interior");\n                },\n            },\n        ],\n    },\n]);\n'})}),"\n",(0,s.jsx)(n.h2,{id:"interactive-maps",children:"Interactive Maps"}),"\n",(0,s.jsx)(n.p,{children:"The same principles apply to Interactive Map passages:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-tsx",children:'// GOOD: Side effects in hotspot actions\nconst worldMap = newInteractiveMap("world-map", {\n    image: "/maps/world.jpg",\n    hotspots: [\n        {\n            type: "label",\n            content: "Treasure Island",\n            position: { x: 70, y: 60 },\n            action: () => {\n                // Side effect in action - safe!\n                if (!player.visitedIsland) {\n                    player.visitedIsland = true;\n                    player.save();\n                }\n                Game.jumpTo("treasure-island");\n            },\n        },\n        // Conditional hotspot - reading state is fine in passage body\n        () =>\n            player.hasMap\n                ? {\n                      type: "label",\n                      content: "Secret Cove",\n                      position: { x: 20, y: 80 },\n                      action: () => Game.jumpTo("secret-cove"),\n                  }\n                : undefined,\n    ],\n});\n'})}),"\n",(0,s.jsx)(n.h2,{id:"summary-the-golden-rule",children:"Summary: The Golden Rule"}),"\n",(0,s.jsx)(n.admonition,{title:"The Golden Rule",type:"tip",children:(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Reading state in passage bodies is safe. Modifying state should only happen in actions."})})}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Safe in Passage Body"}),(0,s.jsx)(n.th,{children:"Must Be in Actions"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Reading entity values"}),(0,s.jsx)(n.td,{children:"Modifying entity values"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Conditional rendering"}),(0,s.jsx)(n.td,{children:"Awarding items/gold"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Displaying current stats"}),(0,s.jsx)(n.td,{children:"Combat calculations"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Checking flags"}),(0,s.jsx)(n.td,{children:"Setting flags"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Generating display content"}),(0,s.jsx)(n.td,{children:"Incrementing counters"})]})]})]}),"\n",(0,s.jsx)(n.p,{children:"By following this pattern, your game will behave correctly when:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Players navigate between passages"}),"\n",(0,s.jsx)(n.li,{children:"Players save and load their game"}),"\n",(0,s.jsx)(n.li,{children:"React re-renders components"}),"\n",(0,s.jsx)(n.li,{children:"Players revisit passages multiple times"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"related-topics",children:"Related Topics"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"/core-concepts",children:"Core Concepts"})," - Entity and passage fundamentals"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"/migrations",children:"Migrations"})," - Handle save compatibility across versions"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},1184:(e,n,t)=>{t.d(n,{R:()=>i,x:()=>o});var a=t(4041);const s={},r=a.createContext(s);function i(e){const n=a.useContext(r);return a.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:i(e.components),a.createElement(r.Provider,{value:n},e.children)}}}]);